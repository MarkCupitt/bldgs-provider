!function(a){"use strict";var b=function(){function a(b,d){d=d||{},this._url=(b||a.URL).replace("{k}",d.key||"anonymous"),this._request=new c,this._fixedZoom=16,this._tileSize=256}a.URL="http://data.osmbuildings.org/0.2/{k}/tile/{z}/{x}/{y}.json";var b=a.prototype;return b._getURL=function(a,b,c){var d={x:a,y:b,z:c};return this._url.replace(/\{([\w_]+)\}/g,function(a,b){return d[b]||a})},b.updateBBox=function(a,b,c,d,e,f){var a,b;for(b=minY;maxY>=b;b++)for(a=minX;maxX>=a;a++)this.load(a,b,this._fixedZoom,f)},b.load=function(a,b,c,e){this._request.get(this._getURL(a,b,c),function(a){"function"==typeof e&&e(d.read(a))})},a}(),c=function(){function a(a){a=a||{};var b=this._cache={},c=this._time=0,d=a.maxAge||5;setInterval(function(){for(var a in b)b[a].time<c&&delete b[a];c=Date.now()},60*d*1e3)}var b=a.prototype;return b.get=function(a,b){var c=this._cache;if(c[a])return void("function"==typeof b&&b(c[a].json));var d=new XMLHttpRequest;return d.onreadystatechange=function(){if(4===d.readyState&&!(!d.status||d.status<200||d.status>299)){var e;if(d.responseText)try{e=JSON.parse(d.responseText)}catch(f){}c[a]={json:e,time:Date.now()},"function"==typeof b&&b(e)}},d.open("GET",a),d.send(null),d},a}(),d=function(){function a(a){var b,c,d,e,f,i,j=0;for(f=0,i=a.length-3;i>f;f+=2)b=a[f],c=a[f+1],d=a[f+2],e=a[f+3],j+=b*e-d*c;return j/2>0?g:h}function b(b,c){var d=a(b);if(d===c)return b;for(var e=[],f=b.length-2;f>=0;f-=2)e.push(b[f],b[f+1]);return e}function c(a){for(var b=90,c=-90,d=0,e=a.length;e>d;d+=2)b=min(b,a[d]),c=max(c,a[d]);return(c-b)/i*6378137/2<<0}function d(a){var b={};switch(a=a||{},a.shape){case"pyramid":case"pyramidal":b.shape="pyramid"}switch(a.roofShape){case"pyramid":case"pyramidal":b.roofShape="pyramid"}return b}function e(a){var c,d,f,i,j=[];switch(a.type){case"GeometryCollection":for(j=[],c=0,d=a.geometries.length;d>c;c++)(i=e(a.geometries[c]))&&j.push.apply(j,i);return j;case"MultiPolygon":for(j=[],c=0,d=a.coordinates.length;d>c;c++)(i=e({type:"Polygon",coordinates:a.coordinates[c]}))&&j.push.apply(j,i);return j;case"Polygon":f=a.coordinates;break;default:return[]}var k,l,m,n=1,o=0,p=[],q=[];for(m=f[0],c=0,d=m.length;d>c;c++)p.push(m[c][n],m[c][o]);for(c=0,d=f.length-1;d>c;c++){for(m=f[c+1],q[c]=[],k=0,l=m.length;l>k;k++)q[c].push(m[k][n],m[k][o]);q[c]=b(q[c],h)}return[{outer:b(p,g),inner:q.length?q:null}]}function f(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var g="CW",h="CCW",i=180/Math.PI,j={};return j.read=function(a,b){if(!a||"FeatureCollection"!==a.type)return[];var g,h,i,j,k,l,m,n,o=a.features,p=[];for(g=0,h=o.length;h>g;g++)if(k=o[g],"Feature"===k.type&&b(k)!==!1)for(m=d(k.properties),l=e(k.geometry),i=0,j=l.length;j>i;i++)n=f(m),n.footprint=l[i].outer,("cone"===n.shape||"cylinder"===n.shape)&&(n.radius=c(n.footprint)),l[i].inner&&(n.holes=l[i].inner),(k.id||k.properties.id)&&(n.id=k.id||k.properties.id),p.push(n);return p},j}();a.BLDGS=b}(this);